<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>模拟微信webview - Archer's Blog</title>
    <!--<link rel="stylesheet" href="/assets/css/font-awesome-4.2.0/css/font-awesome.min.css?ver=1.0.12"/>-->
    <link rel="stylesheet" href="/assets/css/theme.css?ver=1.0.23"/>
    <script src="http://cdn.staticfile.org/jquery/2.1.1/jquery.min.js?ver=1.0.23"></script>
    <!--<script src="http://cdn.staticfile.org/waypoints/2.0.5/waypoints.min.js" type="text/javascript"></script>-->
    <script src="/assets/js/archer.js?ver=1.0.23"></script>
    <script type="text/javascript">

        //Html编码获取Html转义实体
        function htmlEncode(value){
            return $('<div/>').text(value).html();
        }

        //Html解码获取Html实体
        function htmlDecode(value){
            return $('<div/>').html(value).text();
        }

        $(document).ready(function(){

            //菜单
            $('.blog__nav__item').mouseover(function(){
                $(this).siblings().removeClass('nav__current');
                $(this).addClass('nav__current');
            });

            //文章目录生成
            //var hpa = "/<h3>([^<]+)<\/h3>/i";

//            $('.navlink').click(function(){
//                var that = $(this).parent('.blog__nav__item');
//                that.siblings().removeClass('nav__current');
//                that.addClass('nav__current');
//            });

            //缓存分类文章列表
            var catposts = [];

            //首次载入便缓存下来
            if("" != '首页'){

                $.getJSON("/allposts.json", function (data) {
                    $.each(data, function (i, item) {
                        if(item.cat == ""){
                        catposts.push(item);
                        }
                    });

                    //添加
                    $.each(catposts,function(j,item){
                        var content = "";
                        if(j < 0){
                            //alert(j);
                            var excerpt = " + item.excerpt + ";
                            content += "<div class='blogbody__everyblog'>";
                            content += "<div class='blogbody__everyblog__header'>";
                            content += "<a href='" + item.url + "'>" + item.title + "</a>";
                            content += "</div>";
                            content += "<div class='blogbody__everyblog__meta'>";
                            content += "<span class='blogbody__everyblog__metainfo'>" + item.date + "</span>";
                            content += "</div>";
                            content += "<div class='blogcontent blogbody__everyblog__excerpt'>";
                            content += htmlDecode(item.excerpt);
                            content += "</div>";
                            content += "</div>";
                            $('.loadingmore').before(content);
                        }
                    });
                });
            }

//            //nav waypoints
//            $('.blog__nav').waypoint(function(direction){
//                if(direction == "down"){
//                    $('.blog__nav').addClass("fixedposition");
//                }
//                else if(direction == "up"){
//                    $('.blog__nav').removeClass("fixedposition");
//                }
//            });
//
//            //内页目录waypoints
//            $('.sidebar--catcontent').waypoint(function(direction){
//                if(direction == "down"){
//                    $('.sidebar--catcontent').addClass("single--sidebar--fix");
//                }
//                else if(direction == "up"){
//                    $('.sidebar--catcontent').removeClass("single--sidebar--fix");
//                }
//            });

            var totalsize = 0;

            
                
                    
                
                    
                
                    
                
            

            if(totalsize > 0){

                var bloglists = $('.bloglists');
                var count = 0; //一开始的文章数目
                var looptimes = 0; //计数器top

                $('.loadingmore').click(function () {

                    $('.loadingmore').html("<span class='loadingmorespan'>正在加载...</span>");

                    $.getJSON("../allposts.json", function (data) {


                        //alert(data);

                        var content = "";
                        looptimes = count + 0; //初始化
                        var j = 0; //采集loop了多少次

                        if("" == '首页'){
                            $.each(data, function (i, item) {
                                if (i >= count & i < looptimes) {
                                    var excerpt = " + item.excerpt + ";
                                    content += "<div class='blogbody__everyblog'>";
                                    content += "<div class='blogbody__everyblog__header'>";
                                    content += "<a href='" + item.url + "'>" + item.title + "</a>";
                                    content += "</div>";
                                    content += "<div class='blogbody__everyblog__meta'>";
                                    content += "<span class='blogbody__everyblog__metainfo'>" + item.date + "</span>";
                                    content += "</div>";
                                    content += "<div class='blogcontent blogbody__everyblog__excerpt'>";
                                    content += htmlDecode(item.excerpt);
                                    content += "</div>";
                                    content += "</div>";
                                    j++;
                                }
                            });

                            count += j; //现在的文章数目

                            //alert(content);

                            $('.loadingmore').before(content);
                            $('.loadingmore').html("<span class='loadingmorespan'>阅读更多文章</span>");
                            if (count == data.length) {
                                $('.loadingmore').html("<span class='loadingmorespan'>没有更多了...</span>").hide();
                            }

                        }
                        else{
                            $.each(catposts, function (i, item) {
                                if (i >= count & i < looptimes) {
                                    var excerpt = " + item.excerpt + ";
                                    content += "<div class='blogbody__everyblog'>";
                                    content += "<div class='blogbody__everyblog__header'>";
                                    content += "<a href='" + item.url + "'>" + item.title + "</a>";
                                    content += "</div>";
                                    content += "<div class='blogbody__everyblog__meta'>";
                                    content += "<span class='blogbody__everyblog__metainfo'>" + item.date + "</span>";
                                    content += "</div>";
                                    content += "<div class='blogcontent blogbody__everyblog__excerpt'>";
                                    content += htmlDecode(item.excerpt);
                                    content += "</div>";
                                    content += "</div>";
                                    j++;
                                }
                            });

                            count += j; //现在的文章数目
                            $('.loadingmore').before(content);
                            $('.loadingmore').html("<span class='loadingmorespan'>阅读更多文章</span>");
                            if (count == catposts.length) {
                                $('.loadingmore').html("<span class='loadingmorespan'>没有更多了...</span>").hide();
                            }
                        }
                    });
                });
            }

            //如果totalsize<=初始值则不显示
            else{
                //否则不显示翻页
                $('.loadingmore').css('display', 'none');
            }
        });
    </script>

</head>

<!-- 手机导航 -->
<header id="mobile--header" class="mobile--header">
    <i class="fa fa-home"></i><span class="mobile--header--span"><a href="/">Archer's Blog</a></span>
</header>
<header id="blog__header">
    <div class="blog__bighead">
        <div class="blog__head__img">
            <span class="logo--name"><a href="/">ARCHER</a></span>
            <span class="logo--des">WEB DEVELOPER</span>
        </div>
    </div>

    <!-- blog nav -->
    <div class="blog__nav">
        <ul class="blog__nav__ul">
            <li class="blog__nav__item nav__current home__link"><a href="/" class="navlink">首页</a></li>
            <li class="blog__nav__item blog__link"><a href="/blogs/" class="navlink">文字</a></li>
            <li class="blog__nav__item projects__link"><a href="/projects/" class="navlink">项目</a></li>
            <li class="blog__nav__item experiments__link"><a href="/experiments/" class="navlink">实验</a></li>
            <li class="blog__nav__item tools__link"><a href="/tools/" class="navlink">工具</a></li>
        </ul>
    </div>

</header>
<body>
<!-- github ribbon -->
<!--<a href="https://github.com/qddegtya/qddegtya.github.io" target="_blank" id="ribbon--github"><img style="position: absolute; top: 0; left: 0; border: 0;" src="http://xiaoa.name/assets/images/ribbon.png" alt="Fork me on GitHub"></a>-->
<section id="blogbody">
    <div class="clearleft bloglooparea">
        <div class="bloglists">
            <div class="blogbody__everyblog">
                <div class="blogbody__everyblog__header">
                    <a href="/%E5%AE%9E%E9%AA%8C/2014/12/21/%E6%A8%A1%E6%8B%9F%E5%BE%AE%E4%BF%A1webview/">模拟微信webview</a>
                </div>
                <div class="blogbody__everyblog__meta">
                    <span class="blogbody__everyblog__metainfo">2014 - 12 - 21</span>
                </div>
                <div class="blogcontent blogbody__everyblog__excerpt" id="singleblogcontent">
                    <p>在某些前端项目开发过程中，我们需要不断在微信中调试和测试我们的页面，这给本地调试造成了很大的不便。 Weixin-WebView-Mock就是解决这个问题的迷你辅助工具，正所谓：</p>

<blockquote>
  <p>专注于小而美，令人心驰神往</p>
</blockquote>

<p>具体的项目已经放在Github上了，所以这里不再赘述，放上核心实现代码：</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno"> 1</span> <span class="cm">/*</span>
<span class="lineno"> 2</span> <span class="cm"> * 模拟微信webview的行为</span>
<span class="lineno"> 3</span> <span class="cm"> * 调试，测试时可以使用</span>
<span class="lineno"> 4</span> <span class="cm"> * 作者：Archer_小A</span>
<span class="lineno"> 5</span> <span class="cm"> */</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span> 	<span class="kd">var</span> <span class="nx">__wx</span> <span class="o">=</span> <span class="p">{};</span>
<span class="lineno">11</span> 
<span class="lineno">12</span> 	<span class="c1">//call</span>
<span class="lineno">13</span> 	<span class="nx">__wx</span><span class="p">.</span><span class="nx">__call</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">){</span>
<span class="lineno">14</span>         <span class="nx">__wx</span><span class="p">.</span><span class="nx">callMethods</span><span class="p">[</span><span class="nx">m</span><span class="p">]();</span>
<span class="lineno">15</span> 	<span class="p">}</span>
<span class="lineno">16</span> 
<span class="lineno">17</span> 	<span class="c1">//invoke</span>
<span class="lineno">18</span> 	<span class="nx">__wx</span><span class="p">.</span><span class="nx">__invoke</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
<span class="lineno">19</span> 		<span class="nx">__wx</span><span class="p">.</span><span class="nx">invokeMethods</span><span class="p">[</span><span class="nx">m</span><span class="p">](</span><span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="lineno">20</span> 	<span class="p">}</span>
<span class="lineno">21</span> 
<span class="lineno">22</span> 	<span class="c1">//on</span>
<span class="lineno">23</span> 	<span class="nx">__wx</span><span class="p">.</span><span class="nx">__on</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">handler</span><span class="p">){</span>
<span class="lineno">24</span> 		<span class="nx">__wx</span><span class="p">.</span><span class="nx">__events</span><span class="p">[</span><span class="nx">m</span><span class="p">](</span><span class="nx">handler</span><span class="p">);</span>
<span class="lineno">25</span> 	<span class="p">}</span>
<span class="lineno">26</span> 
<span class="lineno">27</span> 	<span class="c1">//invokes</span>
<span class="lineno">28</span> 	<span class="nx">__wx</span><span class="p">.</span><span class="nx">invokeMethods</span> <span class="o">=</span> <span class="p">{</span>
<span class="lineno">29</span> 
<span class="lineno">30</span> 		<span class="c1">//分享到微博</span>
<span class="lineno">31</span> 		<span class="s2">&quot;shareWeibo&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
<span class="lineno">32</span> 			<span class="nx">alert</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]);</span>
<span class="lineno">33</span> 		<span class="p">},</span>
<span class="lineno">34</span> 
<span class="lineno">35</span> 		<span class="c1">//分享到朋友圈</span>
<span class="lineno">36</span> 		<span class="s2">&quot;shareTimeline&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
<span class="lineno">37</span> 			<span class="nx">alert</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]);</span>
<span class="lineno">38</span> 		<span class="p">},</span>
<span class="lineno">39</span> 
<span class="lineno">40</span> 		<span class="c1">//发送给好友</span>
<span class="lineno">41</span> 		<span class="s2">&quot;sendAppMessage&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
<span class="lineno">42</span> 			<span class="nx">alert</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]);</span>
<span class="lineno">43</span> 		<span class="p">}</span>
<span class="lineno">44</span> 
<span class="lineno">45</span> 	<span class="p">}</span>
<span class="lineno">46</span> 
<span class="lineno">47</span> 	<span class="c1">//接口</span>
<span class="lineno">48</span> 	<span class="nx">__wx</span><span class="p">.</span><span class="nx">callMethods</span> <span class="o">=</span> <span class="p">{</span>
<span class="lineno">49</span> 		<span class="c1">//隐藏右上角按钮</span>
<span class="lineno">50</span> 		<span class="s2">&quot;hideOptionMenu&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
<span class="lineno">51</span> 			<span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;你调用了隐藏右上角按钮&quot;</span><span class="p">);</span>
<span class="lineno">52</span> 		<span class="p">}</span>
<span class="lineno">53</span> 	<span class="p">}</span>
<span class="lineno">54</span> 
<span class="lineno">55</span> 	<span class="c1">//eventlistener</span>
<span class="lineno">56</span> 	<span class="nx">__wx</span><span class="p">.</span><span class="nx">__events</span> <span class="o">=</span> <span class="p">{</span>
<span class="lineno">57</span> 
<span class="lineno">58</span> 		<span class="c1">//菜单-分享到微博</span>
<span class="lineno">59</span> 		<span class="s2">&quot;menu:share:weibo&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handler</span><span class="p">){</span>
<span class="lineno">60</span> 			<span class="nx">handler</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<span class="lineno">61</span> 		<span class="p">},</span>
<span class="lineno">62</span> 
<span class="lineno">63</span> 		<span class="c1">//菜单-发送给好友</span>
<span class="lineno">64</span> 		<span class="s2">&quot;menu:share:appmessage&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handler</span><span class="p">){</span>
<span class="lineno">65</span> 			<span class="nx">handler</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<span class="lineno">66</span> 		<span class="p">},</span>
<span class="lineno">67</span> 
<span class="lineno">68</span> 		<span class="c1">//菜单-分享到朋友圈</span>
<span class="lineno">69</span> 		<span class="s2">&quot;menu:share:timeline&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handler</span><span class="p">){</span>
<span class="lineno">70</span> 			<span class="nx">handler</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<span class="lineno">71</span> 		<span class="p">}</span>
<span class="lineno">72</span> 
<span class="lineno">73</span> 	<span class="p">}</span>
<span class="lineno">74</span> 
<span class="lineno">75</span> 
<span class="lineno">76</span> 	<span class="c1">//暴露给window的WeixinJSBridge</span>
<span class="lineno">77</span> 	<span class="nb">window</span><span class="p">.</span><span class="nx">WeixinJSBridge</span> <span class="o">=</span> <span class="p">{</span>
<span class="lineno">78</span> 		<span class="s2">&quot;call&quot;</span><span class="o">:</span> <span class="nx">__wx</span><span class="p">.</span><span class="nx">__call</span><span class="p">,</span>
<span class="lineno">79</span> 		<span class="s2">&quot;invoke&quot;</span><span class="o">:</span> <span class="nx">__wx</span><span class="p">.</span><span class="nx">__invoke</span><span class="p">,</span>
<span class="lineno">80</span> 		<span class="s2">&quot;on&quot;</span><span class="o">:</span> <span class="nx">__wx</span><span class="p">.</span><span class="nx">__on</span>
<span class="lineno">81</span> 	<span class="p">}</span>
<span class="lineno">82</span> 
<span class="lineno">83</span> <span class="p">}());</span></code></pre></div>

<h3 id="in-github">in github</h3>

<p><a href="https://github.com/qddegtya/Weixin-WebView-Mock" title="Weixin-WebView-Mock">Weixin-WebView-Mock</a></p>

                </div>
                <div class="blogbody__everyblog__footer">
                    <div class="footercopyright">
                        <span>警告! 转载时请注明本文出处:</span>
                        <span class="blogperlink">http://xiaoa.name/%E5%AE%9E%E9%AA%8C/2014/12/21/%E6%A8%A1%E6%8B%9F%E5%BE%AE%E4%BF%A1webview/</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="blogsidebar single__sidebar">
    <!-- 头像 -->
    <div class="avatar--footer">
        <img src="http://xiaoa.name/assets/images/avatar.jpeg">
    </div>

    <!-- 链接区域 -->
    <div class="follow-panel">
        <span class="sns"><a href="https://github.com/qddegtya" title="github" target="_blank">Github</a> / <a href="http://www.weibo.com/IMArcher" title="weibo" target="_blank">Weibo</a> / <a href="http://www.weibo.com/IMArcher" title="about" target="_blank">About</a></span>
        <div>
</div>
    </div>
</section>

<footer id="blogfooter">

</footer>

</body>
</html>